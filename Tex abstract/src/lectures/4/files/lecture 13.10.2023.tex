	\subsection{Группа классов идеалов и её элементарное вычисление}

	Понятие нормы легко распространить на дробные идеалы: если $I, J \subset \cO_{K}$~--- целые идеалы, то мы можем положить 
	\[
		\Nm(I J^{-1}) \eqdef \frac{\Nm(I)}{\Nm(J)} 
	\]

	Проверим, что это определение корректно. Действительно, пусть $I_1 J_1^{-1} = I_{2} J_{2}^{-1}$, тогда  $I_1 J_2 = I_2 J_1$, что означает, что 
	\[
		\Nm(I_1)\Nm(J_2) = \Nm(I_2)\Nm(J_1) \implies \Nm(I_1)\Nm(J_1)^{-1} = \Nm(I_2) \Nm(J_2)^{-1}.
	\]

	\begin{definition} 
		Как мы помним, у нас есть понятие группы дробных идеалов $\mathrm{I}(K)$ (и в силу основной теоремы арифметики, она порождена простыми идеалами).В ней есть подгруппа из \emph{главных дробных идеалов} $a\cO_{K}, \ a \in K^{*}$.  Эту подгруппу мы будем обозначать, как $\mathrm{PI}(K)$. Факторгруппу $\mathrm{I}(K)/\mathrm{PI}(K)$ называют \emph{группой классов идеалов} и обозначают 
	\[
		\Class(K) \eqdef \mathrm{I}(K)/\mathrm{PI}(K).
	\]
	\end{definition}

	

	% Ну и, как Вам кажется, какой ответ? 
	% Какой порядок? Ну, 4. 
	% Да, это правильно. Значит, либо C_4, либо C_2 \times C_2. Какой вариант реализуется? 
	% Ну, интуитивно кажется, что второй. 
	% Интуитивно -- да. А на самом деле -- нет. 

	\begin{theorem} 
		Пусть $K/\Q$~--- конечное расширение. Тогда группа $\Class(K)$ конечна. 
	\end{theorem}

	\begin{proof}
		Итак, пусть $n = [K : \Q]$, $\omega_1, \ldots, \omega_n$~--- целый базис. Пусть $\sigma_i\colon K \to \C$~--- все вложения $K$ в $\C$, а $C = \max|\sigma_i(\omega_j)| > 0$. Возьмём произвольный элемент $\alpha \in \Class(K)$, тогда 
	\[
		\alpha^{-1} = [J], \ J \text{~--- целый идеал в кольце } \cO_{K}.
	\]

	Тогда $\alpha = [J^{-1}]$. Рассмотрим множество 
	\[
		S = \left\{ \sum_{i = 1}^{n} x_{i} \omega_{i} \ \bigg\vert \ 0 \le x_i \le \left[\Nm\lr*{J}^{\frac{1}{n}}\right]\right\}, \quad \left\lvert S \right\rvert > \lr*{|\Nm(J)|^{\frac{1}{n}}}\Nm(J) = \lvert \cO_{K}/J \rvert.
	\]
	Из оценки на порядок следует, что найдутся $\sum_{i = 1}^{n} x_i \omega_i, \ \sum_{j = 1}^{n} y_i \omega_i \in S$ такие, что 
	\[
		z = \sum_{i = 1}^{n}(x_i - y_i)\omega_i \in J.
	\]

	Рассмотрим идеал $I = z J^{-1}$, это целый идеал кольца $\cO_{K}$ (так как $z \in J$), $[I] = [J^{-1}] = \alpha$, так как они отличаются на главный идеал. Рассмотрим $[I] \cdot [J] = (z) = z\cO_{K}$ и оценим норму этого главного идеала:
	\begin{multline*}
		\Nm(I)\Nm(J) = \Nm(IJ) = \Nm((z)) = \left\lvert \Nm(z)\right\rvert =  \prod\limits_{j = 1}^{n}\left\lvert \sigma_j\lr*{\sum_{i = 1}^{n}(x_i - y_i)\omega_i} \right\rvert  \le  \prod_{j = 1}^{n}\lr*{\sum_{i = 1}^{n}|x_i - y_i|\left\lvert\sigma_{j}(\omega_i)\right\rvert} \le \\ \underbrace{\le}_{|x_i - y_i| < 2\Nm(J)^{\frac{1}{n}}, \ |\sigma_j(\omega_i) < C|}    \prod_{j = 1}^{n} \lr*{n \cdot 2 \Nm(J)^{\frac{1}{n}} \cdot C} = 2 n^n C^n \Nm(J) \implies \Nm(I) \le 2 n^n \cdot C^n.
	\end{multline*}

	Таким образом мы показали, что для любого класса из $\Class(K)$ мы можем выбрать представителя с ограниченной нормой. Но, идеалов с ограниченной нормой лишь конечное число, так как 
	\[
		I = \fp_{1}^{k_1} \cdot \ldots \cdot \fp_m^{k_m} \implies \Nm(I) = \prod_{i = 1}^{m} \Nm\lr*{\fp_{k}}^{k_i} \le n^n C^n.
	\]
	, а для выполнения этого неравенства  можно подобрать  лишь конечное число $\fp_i$, так как $\Nm(\fp_{i}) = \left\lvert \cO_{K}/\fp_i \right\rvert \ge p$ (так как $\cO_{K}/\fp_i$~--- это векторное пространство над $\F_{p}$, где $p\Z = \Z \cap \fp_{i}$).  Это даёт нам, что у нас конечное число классов идеалов. 	

	\end{proof}

	\begin{example}
		Вычислим группу классов идеалов для поля $K = \Q\lr*{\sqrt{-14}}$.

		Основной факт состоит в том, что произвольный $\fp \in \Spec{\cO_{K}}$ выражается через максимальные идеалы, висящие над $(2)$ и $(3)$. Пока что поверим в этом и посчитаем при помощи этого факта группу $\Class(K)$.

		Нетрудно убедиться в том, что 
		\[
			2\cO_{K} = (2) = (2, \sqrt{-14})^{2} = \fp_{2}^{2}, \quad \Nm(\fp_{2}) = 2. 
		\]

		Так как $\lr*{\frac{-14}{3}} = 1$, $3\cO_{K} = \fp_{3} \fp_{3}'$. Как мы знаем, $\cO_{K} = \Z[\sqrt{-14}]$, а в этом кольце 
		\[
			\Nm_{K/\Q}(a + b \sqrt{-14}) = a^2 + 14b^2 \neq 2 \implies \fp_{2} \text{~--- не может быть главным идеалом,}
		\]
		из чего следует, что образ $\fp_{2}$ нетривиален в группе $\Class(K)$. 
		Кроме того, так как $\Nm((3)) = 9,$  $\Nm(\fp^{3}) = \Nm(\fp_{3}') = 3$, что даёт нам то же самое. Заметим, что $\fp_{3}^2$ не является глаынм идеалом, но $[\fp_{3}^2] = [\fp_{2}]$. Действительно, возьмем $(2 + \sqrt{-14}), \ \Nm((2 + \sqrt{-14}) = 18$, но идеал $(2 + \sqrt{-14})$ раскладывается в произведение максимальных, лежащих либо над $(2)$, либо над (3), так $\Nm(2 + \sqrt{-14}) = 18 = 2 \cdot 3^2$. Это даёт нам, что 
		\[
			(2 + \sqrt{-14}) = \fp_{2} \fp_{3}^{(?)}\fp_{3}^{(?)}.
		\]

		Так как $(1 + \sqrt{-14})(1 - \sqrt{-14}) = 15$, мы можем положить $\fp_{3} = (3, 1 + \sqrt{-14})$, а $\fp_{3}' = (3, 1 - \sqrt{-14})$. Так как $(2 + \sqrt{-14}) \in (3, 1 - \sqrt{-14})$, мы можем заключить, что $\fp_{2}\fp_{3}^{(?)}\fp_{3}^{(?)} \subset \fp_{3}'$, что даёт нам 
		\[
		 	[\fp_{2}] [\fp_{3}']^{2} = [1], \quad [\fp_{2}] = [\fp_{3}]^{2}
		\] 

		Теперь докажем озвученное в начале примера утверждение индукцией по \( p \colon p\Z = \Z \cap \fp \). 
		\[
			\fp_{2}^{2} = (2), \quad \fp_{7}^{2} = (7), \quad \fp^{2}_{2} \fp_{7}^{2} = (14) = (\sqrt{-14})^2 \implies \fp_{2} \fp_{7} = (\sqrt{-14}) \implies [\fp_{2}]^{-1} = [\fp_{7}] \implies [\fp_{2}] = [\fp_{2}]^{-1} = [\fp_{7}].
		\]

		Теперь рассмотрим остальыне простые числа. Все они делятся на две группы: по модулю которых $-14$~--- квадратичный вычет или невычет. 

		Пусть сначала $-14$~--- невычет по модулю $p$. Тогда идеал $p\Z$ остаётся простым в $\cO_{K}$, таким образом, мы имеем единственный простой идеал, сидящий над $p$ и этот идеал главный, что даёт нам что $[\fp]$ тривиален в $\Class(K)$. 

		Теперь пусть $-14$~--- квадратичный вычет по модулю $p$. Тогда $\exists x \in \Z \colon p \mid x^2 + 14$. Можно считать, что $0 \le x \le \frac{p - 1}{2}$.  Тогда мы имееем, что $x^2 + 14 = pm \le \lr*{\frac{p - 1}{2}}^2 + 14$. Кроме того, в этом случае 
		\[
			p\cO_{K} = \fp_{1}\fp_{2}, \quad \Nm(\fp_{1}) = \Nm(\fp_{2}) = p, \quad \fp'_{1} = (p, x + \sqrt{-14}), \ \fp'_{2} = (p, x - \sqrt{-14}). 
		\]
		
		Если $p \ge 5$, то $m < p$, так как  будут справделивы такие неравенства:
		\[
			m  < \frac{\frac{p^2}{4} + 14}{p} < p.
		\]
		Кроме того, \( (x + \sqrt{-14}) \subset \fp'_{1} \implies (x + \sqrt{-14}) \subset \fp'_{1}I\). Заметим, что $pm = \Nm(x + \sqrt{-14}) = \N(\fp'_{1})\Nm(I)$, а $\Nm(\fp'_{1}) = p$, то есть $\Nm(I) = m < p$. Это даёьт нам, что в разложении $I$  на максимальные лежат только идеалы, лежащие над меньшими простыми числами. Иными словами, если 
		\[
			I = \fq_{1}^{k_1} \cdot \ldots \cdot \fq_{s}^{k_s}, \ \fq_{i} \cap \Z = q_i\Z, \ q_i \le p, q_i \text{~--- простое}.
		\]
		Это даёт нам возможность применить индукционное предположение: $[\fq_{i}]$ выражаются только через $\fp_{2}$ и $\fp_{3}$. Теперь заметим, что $[\fp'_{1}] = [I^{-1}]$, из чего следует, что $\fp = \fp'_{1}\fp'_{2}$  тоже выражается через $\fp_{2}$ и $\fp_{3}$, что и требовалось. 

	\end{example}

	\noindent\bf{Группа классов идеалов мнимого квадратичного поля $\Q\lr*{\sqrt{d}}$}
	\vspace{-2mm}
	\begin{enumerate}
		\item Если $d = -1, -2, -3, -7$, то $\cO_{K}$~--- еклидово, а значит, кольцо главных идеалов, то есть $\Class(K) = e$. 

		\item Если $d = -11, -19$, то справедлив аналогичный результат. Кольцо $\Z\left[\sqrt{-11}\right]$ также евклидово, но установить это сложнее. Кольцо $\Z[\sqrt{-19}]$ уже не является евклиовым, но является кольцом главных идеалов. Аналогичное верно и для $d = -43, -67, -163$.

		\item Невероятно, но выполняется следующий факт: 
		\[ 
			\cfrac{\log{\left\lvert \Class(\Q\sqrt{-d}) \right\rvert}}{\log{\sqrt{\disc{K}}}} \xrightarrow{d \to \infty} 1.
		\]

		\item Табличку с группами классов идеалов мнимых квадратичных полей можно найти в конце книжки Боревич-Шафаревич. 
	\end{enumerate}

	\noindent\bf{Следствия из теоремы о конечности групп классов идеалов:}

	\bf{1.} Если $h = \left\lvert \Class(K) \right\rvert$,  то для любого дробного идеала $I\colon I^{h}$ является главным.

	\bf{2.} Если $(\ell, h) = (1)$ и $I^{\ell}$ главный, то $I$~--- главный. Действительно, 
	\[
		a\ell + bh = 1 \implies I = I^{a\ell + bh} = \lr*{I^{\ell}}^{a} \lr*{I^{h}}^{b}.
	\]

	\bf{3.} Существует такое конечное расщирение $L/K$, что любой дробный идеал $I$ кольца $\cO_{K}$ идеал $I\cO_{L}$ будет главным. (см. \emph{проблема башни полей классов}).
	\begin{proof}
		Итак, пусть $I_1, \ldots, I_{m}$~--- представители группы классов идеалов. Пусть $I_i^{h} = (x_i)$. В качестве поля $L$ мы возьмём: 
		\[
			L = K\lr*{\sqrt[h]{x_1}, \ldots, \sqrt[h]{x_m}}.
		\]

		\[
			I_{j}^h \cO_{L} = \lr*{\sqrt[h]{x_j}}^{h}\cO_{L} \implies I_j\cO_{L} = (\sqrt[h]{x_j})\cO_{L}. 
		\]

		Кроме того, $\exists j\colon I I_{j}^{-1}$~--- главный. Тогда $I \cO_{L} \lr*{I_{j}\cO_{L}}^{-1}$~--- главный, из чего следует, что $I \cO_{L}$~--- главный. 
	\end{proof}

	\begin{homework}\label{hw_6}
		Задачи: 
		\begin{enumerate}
			\item Вычислите группу классов идеалов для $K = \Q\lr*{\sqrt{-5}}, \ \Q\lr*{\sqrt{-6}}, \ \Q\lr*{\sqrt{10}}, \ \Q\lr*{\sqrt{-19}}$.

			\item Положим $\cO_{K}^{*} = \{ x \in K \ \vert \ \Tr_{K/\Q}(xy) \in \Z \ \forall y \in \cO_{K} \}$.
				\begin{enumerate}
					\item Доказать, что $\cO_{K}^{*}$~--- дробный идеал и $\cO_{K} \subset \cO_{K}^{*}$.

					\item Доказать, что $\left\lvert \disc(K) \right\rvert = \left\lvert \cO_{K}^*/\cO_{K} \right\rvert$.

					\item Доказать, что $\left\lvert \disc(K) \right\rvert$ есть норма некоторого идеала в $\cO_{K}$.
				\end{enumerate}
			\item Пусть $V$~--- конечномерное векторное пространство над полем $F$, $A \in \mathrm{End}(V)$, причём $A$~--- нильпотентный. Докажите, что тогда $\Tr(A) = 0$.

			\item Пусть $I$~--- дробный идеал. Докажите, что как абелева группа $d\lr*{\Nm(I)}$ (дробный идеал в $\Z$) порождается элементами $\Nm(x), x \in I$.
		\end{enumerate}

	\end{homework}




	